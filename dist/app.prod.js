"use strict";var express=require("express"),path=require("path"),logger=require("morgan"),cookieParser=require("cookie-parser"),session=require("express-session"),dotenv=require("dotenv"),passport=require("passport"),Auth0Strategy=require("passport-auth0"),flash=require("connect-flash"),userInViews=require("./lib/middleware/userInViews"),authRouter=require("./routes/auth"),indexRouter=require("./routes/index"),usersRouter=require("./routes/users"),mysql=require("mysql"),sequelize=require("sequelize"),pug=require("pug"),stream=require("getstream");dotenv.config(),client=stream.connect("9yh73fspxyk4","gcdcvs2vfjwh7y9kuf3rybrmzw5jg43yzqv2a2qyyrv9jp9kq4krtmha9qqz79km","81855"),client=stream.connect("9yh73fspxyk4",null,"81855");var strategy=new Auth0Strategy({domain:process.env.AUTH0_DOMAIN,clientID:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,callbackURL:process.env.AUTH0_CALLBACK_URL||"http://localhost:3000/callback"},function(e,r,s,t,u){return u(null,t)});passport.use(strategy),passport.serializeUser(function(e,r){r(null,e)}),passport.deserializeUser(function(e,r){r(null,e)});var app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","pug"),app.use(logger("dev")),app.use(cookieParser());var sess={secret:"CHANGE THIS SECRET",cookie:{},resave:!1,saveUninitialized:!0};"production"===app.get("env")&&(sess.cookie.secure=!0),app.use(session(sess)),app.use(passport.initialize()),app.use(passport.session()),app.use(express.static(path.join(__dirname,"public"))),app.use(flash()),app.use(function(e,r,s){e&&e.query&&e.query.error&&e.flash("error",e.query.error),e&&e.query&&e.query.error_description&&e.flash("error_description",e.query.error_description),s()}),app.use(userInViews()),app.use("/",authRouter),app.use("/",indexRouter),app.use("/",usersRouter),app.use(function(e,r,s){var t=new Error("Not Found");t.status=404,s(t)}),"development"===app.get("env")&&app.use(function(e,r,s,t){s.status(e.status||500),s.render("error",{message:e.message,error:e})}),app.use(function(e,r,s,t){s.status(e.status||500),s.render("error",{message:e.message,error:{}})}),module.exports=app;